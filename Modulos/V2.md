```mermaid
flowchart TD
    %% =============================
    %% ALIMENTAÇÃO - ATUALIZADO
    %% =============================
    subgraph Power_Supply["Alimentação (Otimizada)"]
        direction TB
        USB["Micro USB"] -->|5V 2.5A| FUSE["Fuse 3A (U4)"]
        FUSE --> DIODE["D1: 1N5819W (Proteção Reversa)"]
        DIODE -->|V_SYS| LDO["MCP1700-3.3 (U13)"]
        LDO -->|3.3V| SYSTEM["Sistema Principal"]
        
        BAT["Baterias 18650 (Paralelo)"] --> CHARGE["TP5100 (Carregador)"]
        CHARGE -->|CHRG#| LED_CHARGE["LED Azul (Carga)"]
        CHARGE -->|STDBY#| LED_STANDBY["LED Verde (Standby)"]
        
        SYSTEM --> JMP["Jumpers de Seleção"]
        JMP -->|3.3V| MCU["MCUs e Periféricos"]
        JMP -->|5V| USB_DEV["Dispositivos USB"]
    end

    %% =============================
    %% INTERFACE DE USUÁRIO - ATUALIZADO
    %% =============================
    subgraph UI["Interface do Usuário (Atualizada)"]
        direction LR
        MCU -->|GPIO| BUTTONS["Botões Táteis (x4)"]
        MCU -->|PWM| LEDS["LEDs RGB (Endereçáveis)"]
        MCU -->|I2C| ENCODER["Encoder Rotativo + Display OLED"]
    end

    %% =============================
    %% NFC/IR - ATUALIZADO
    %% =============================
    subgraph NFC_IR["Sistema NFC/IR (Revisado)"]
        direction TB
        MCU -->|I2C| NFC["PN532 (Modo I2C)"]
        NFC --> ANTENNA["Antena PCB Otimizada"]
        
        MCU -->|GPIO| IR_TX["TSAL6200 (Transmissor IR)"]
        IR_TX -->|38kHz| IR_MOD["Circuito Modulador"]
        IR_RX["VS1838B (Receptor)"] -->|Demodulado| MCU
    end

    %% =============================
    %% SDR CLONE - ATUALIZADO
    %% =============================
    subgraph SDR["Rádio Definido por Software (Atualizado)"]
        direction TB
        
        subgraph MCU_CTRL["Controle Principal"]
            RP2040 -->|SPI| RF_MODEM["AT86RF215"]
            RP2040 -->|GPIO| MIXER["RFFC5072A"]
            RP2040 -->|UART| ESP32["ESP32-S3 (WiFi/BT)"]
        end
        
        subgraph RF_FRONTENDS["Frontends RF"]
            RF_MODEM -->|Sub-1GHz| FILTER1["Filtro LFCN-1000+"]
            MIXER -->|30MHz-6GHz| FILTER2["Filtro SAW"]
            HF_AMP["Amplificador HF"] -->|15-30MHz| FILTER3["Filtro Passa-Banda"]
        end
        
        subgraph ANTENNAS["Sistema de Antenas"]
            FILTER1 --> RELAY1["Relé RF"] --> SMA1["SMA Sub-1GHz"]
            FILTER2 --> RELAY2["Relé RF"] --> SMA2["SMA 6GHz"]
            FILTER3 --> RELAY3["Relé RF"] --> SMA3["SMA HF"]
        end
        
        TCXO["TCXO 26MHz"] --> CLK_DIST["Distribuidor de Clock"]
        CLK_DIST --> RF_MODEM & MIXER & HF_AMP
    end

    %% =============================
    %% CONEXÕES CRÍTICAS
    %% =============================
    Power_Supply -->|3.3V| MCU
    Power_Supply -->|3.3V| NFC_IR
    Power_Supply -->|5V| SDR
    
    MCU -->|I2C| UI
    MCU -->|UART| SDR
    
    SDR -->|GPIO| UI["Feedback Visual"]
    
    %% =============================
    %% LEGENDA ATUALIZADA
    %% =============================
    legend[("
        Convenções:
        █ Linhas Vermelhas: Sinais RF (50Ω)
        █ Linhas Azuis: Comunicação Digital
        █ Linhas Verdes: Alimentação
        █ Setas Pretas: Controle
    ")]
    
    %% =============================
    %% NOTAS TÉCNICAS
    %% =============================
    note[("
        Melhorias Implementadas:
        1. Proteção contra reversão de polaridade
        2. Filtragem melhorada na alimentação RF
        3. Sistema de clock distribuído
        4. Isolamento entre estágios RF
        5. Controle digital de relés RF
    ")]
```

### Principais Atualizações:

1. **Alimentação Otimizada**:
   - Adicionado proteção contra reversão com diodo Schottky
   - Circuito de carregamento de bateria com feedback visual
   - Jumpers de seleção de tensão

2. **RF Aprimorado**:
   - Clock único distribuído para todos os módulos RF
   - Relés RF para comutação de antenas
   - Filtros dedicados para cada banda

3. **Controle Digital**:
   - Comunicação serial entre RP2040 e ESP32
   - GPIOs dedicados para controle de estágios RF
   - Sistema de feedback visual integrado

4. **NFC/IR Atualizado**:
   - Modulação digital do sinal IR
   - Antena NFC com casamento de impedância
   - Isolamento dos circuitos analógicos

5. **Interface Moderna**:
   - Encoder rotativo com display OLED
   - LEDs RGB endereçáveis
   - Botões com debounce via software

### Checklist de Validação:
- [ ] Testar consumo em todos os modos de operação
- [ ] Verificar isolamento entre estágios RF
- [ ] Calibrar filtros com analisador de rede
- [ ] Validar protocolos de comunicação
